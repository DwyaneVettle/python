

# 正则表达式



## 1.正则表达式基础

文本处理已经成为计算机工常见工作之一，对文本内容的搜索、定位、提取是逻辑比较复杂的工作，为了方便解决这个问题，产生了正则表达式。正则表达式诞生于脚本语言Perl，慢慢的其他语言接纳了这个方式，所以成为了一个专门的技术。

正则表示“规则的”、“极好的”，正则表达式实际就是规定了一组文本模式匹配规则的符号语言，一条正则表达式也称为一个模式，使用这些模式可以匹配指定文本中的表达式模式相同的字符串。

元字符和预定义字符集是学习正则表达式的基础。

```python
import re
s = "刘德华，1961年9月27日出生于中国香港，籍贯广东新会，中国香港影视男演员、歌手、制片人、作词人。1981年出演电影处女作《彩云曲》。1983年主演的武侠剧《神雕侠侣》在香港取得62点的收视纪录  。1985年发行首张个人专辑《只知道此刻爱你》 。1990年凭借专辑《可不可以》在歌坛获得关注 。1991年创办天幕电影公司 。1994年获得十大劲歌金曲最受欢迎男歌星奖；同年担任剧情片《天与地》的制片人 1995年在央视春晚上演唱其代表作《忘情水》 [13]  。2000年凭借警匪片《暗战》获得金像奖最佳男主角奖  同年被《吉尼斯世界纪录大全》评为获奖最多的香港男歌手"

# 打印《》及里面的内容
print(re.findall(r"《\w+?》",s))
```





### 1.1.元字符

​	元字符指在正则表达式中具有特殊含义的专用字符，可以用来规定其前导字符（位于元字符之前的字符）在目标对象中出现的模式。正则表达式中的元字符一般由特殊字符和符号组成，常用字符见下表：

| 元字符    | 含义                                         |
| --------- | -------------------------------------------- |
| .         | 匹配任何一个字符（除换行符外）               |
| ^         | 脱字符，匹配行的开始                         |
| $         | 美元符，匹配行的结束                         |
| \|        | 连接多个可选字符，匹配表达式中出现的任意子项 |
| []        | 字符组，匹配其中出现的任意一个字符           |
| -         | 连字符，表示范围，如"1-5"等价于1,2,3,4,5     |
| ？        | 匹配其前导元素0次或1次                       |
| *         | 匹配其前导元素0次或多次                      |
| +         | 匹配其前导元素0次或多次                      |
| {n}/{m,n} | 匹配其前导元素n次/匹配其前导元素m-n次        |
| ()        | 在模式中划分出子模式，并保存子模式的匹配结果 |



其详细用法如下：

- **点字符"."**

可匹配字母、数字、下划线、空白符(除换行符\n外)等任意单个字符，其用法示例如下：

​	（1）J.m：匹配以字母J开头 ，字母m结尾，中间为任意一个字符的字符串，匹配结果可以是Jam,Jom,J2m等；

​	（2）..：匹配任意两个字符，可以是12，2n，@#等；

​	（3）.m:匹配以任意字符开头，m结尾的字符串，可以是1m,xm,#m,\tm等。

- **脱字符"^"和美元符"$"**

  脱字符和美元符分别用于匹配行头和行尾。

  （1）^cat：只能匹配行首出现cat，如category；

  （2）cat$：只能匹配行尾出现cat，如concat；

  （3）^cat$：匹配只有cat的行；

  （4）^$：匹配空行。

- **连接符"|"**

  连接符可将多个不同的子表达式进行逻辑连接，可简单的将"|"理解为逻辑运算中的"或"，匹配结果为与任意一个子表达式模式相同的字符串。

  （1）a|b|c|d：匹配字符abcd中的任意一个；

  （2）cat|dog：匹配cat或dog；

  （3）c|xyz：匹配字符c或字符串xyz。

- **字符组**"[]"

  字符组的功能是匹配其中的任意一个字符，与"|"不同，"|"既能匹配单个字符，也能匹配字符串，但"[]"只能匹配单个字符。

  （1）args[vs]：匹配以字符串args开头，以字符串v或s结尾的字符串，匹配结果可能是argsv或argss；

  （2）[cC]hina：匹配以字符c或C开头，以hina结尾的字符串，匹配结果可以是china或China；

  （3）[z!*?]：匹配z,!,*,?中任意一个。

  ​	字符组外的字符从前到后一次匹配，如在表达式"args[vs]"中，字符组外的字符a,r,g,s的匹配方式是先匹配a，再匹配r，之后再匹配g和s，而字符组中的所有字符都是同级的，没有先后顺序。

- **连字符"-"**

  连字符一般在字符组中使用，表示一个范围，如字符组[0-9]表示匹配0-9之间的一位数字。

- **匹配符"?"**

  元字符"?"表示匹配其前导元素0次或1。

  (1)June?：匹配元字符"?"前的字符"e"0次或1次，匹配到结果可能是Jun或June;

  (2)July?：匹配元字符"?"前的字符"y"0次或1次，匹配到的结果可能是Jul或July。

- **重复模式**

  正则表达式中使用"*","+","{}"符号来限定其前导元素的重复模式。

  （1）ht*p：匹配字符"t"0次或多次，匹配结果可能是hp,htp,http,htttp等；

  （2）ht+p：匹配字符1次或多次，匹配结果可能是htp,http,htttp，但不可能是hp;

  （3）ht{2}p：匹配字符"t"2次，匹配结果只能是http；

  （4）ht{2,4}p：匹配字符"t"2-4次，匹配结果可能是http,htttp,httttp。

- **子组**

  在正则表达式中，使用"()"可以对一组字符串中的某些字符进行分组。

  （1）Jan(uary)?：匹配子组"uary"0次或1次，匹配结果可能是Jan或January;

  （2）Feb(ruary)?：匹配子组"ruary"0次或1次，匹配结果可能是Feb或February。



### 1.2.预定义字符集

​	正则表达式中预定义了一些字符集，字符集能以简介的方式表示一些由元字符和普通字符定义的匹配规则。常见的预定义字符集如下表：

| 预定义字符 | 含义                                            |
| ---------- | ----------------------------------------------- |
| \w         | 匹配下划线"_"或任何字母(a-z,A-Z)与数字(0-9)     |
| \s         | 匹配任意空白字符，等价于[<空格>\t\r\n\f\v]      |
| \d         | 匹配任意数字，等价于[0-9]                       |
| \b         | 匹配单词的边界                                  |
| \W         | 与\w相反，匹配特殊字符                          |
| \S         | 与\s相反，匹配任意非空白字符的字符，等价于[^\s] |
| \D         | 与\d相反，匹配任意非数字字符，等价于[^\d]       |
| \B         | 与\b相反，匹配不出现在单词边界的元素            |
| \A         | 仅匹配字符串开头，等价于^                       |
| \Z         | 仅匹配字符串结尾，等价于$                       |

可通过在线正则表达式工具http://www.pyregex.com/进行如上测试。



## 2.re模块

Python中的re模块是正则表达式模块，该模块提供了文本匹配查找、文本替换、文本分割等功能。re模块中常用的函数及方法如下：

| 函数/方法  | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| compile()  | 对正则表达式进行预编译，并返回一个Pattern对象                |
| match()    | 从头匹配，匹配成功返回匹配对象，失败返回None                 |
| search()   | 从任意位置开始匹配，匹配成功返回匹配对象，否则返回None       |
| split()    | 将目标对象使用正则对象分隔，成功返回对象（是一个列表），可指定最大分割次数 |
| findall()  | 在目标对象中从左至右查找与正则对象匹配的所有非重叠子串，将这些子串组成一个列表并返回 |
| finditer() | 功能与findall()相同，但返回的是迭代器对象iterator            |
| sub()      | 搜索目标对象中与正则对象匹配的子串，使用指定字符串替换，并返回替换后的对象 |
| subn()     | 搜索目标对象中与正则对象匹配的子串，使用指定字符串替换，返回替换后的对象和替换次数 |
| group()    | 返回全部匹配对象                                             |
| groups()   | 返回一个包含全部匹配的子组的元组，若匹配失败，则返回空元组   |

​	其中，compile()是re模块中的函数，返回值为一个正则对象；group()和groups()是匹配对象的方法；其余的是正则对象的方法，这些方法大多在re模块中也有对应的函数实现，因此用户可通过"正则对象.方法"的方式或"re.函数"的方法使用模块功能。



## 3.预编译

​	如果需要对一个正则表达式重复使用，可以使用compile()函数对其预编译，以避免每次编译正则表达式的开销。compile()函数的用法如下:

```python
compile(pattern,flags=0)		
```

参数pattern表示一个正则表达式，参数flags用于指定正则匹配的模式，该参数的常用取值有如下：

| flags | 说明                                                         |
| ----- | ------------------------------------------------------------ |
| re.I  | 忽略大小写                                                   |
| re.L  | 做本地化识别(local-aware)匹配，使预定义字符集\w,\W,\b,\B,\s,\S取决于当前区域设置 |
| re.M  | 多行匹配，影响^和$                                           |
| re.S  | 使.匹配所有字符，包括换行符                                  |
| re.U  | 根据Unicode字符集解析字符                                    |
| re.A  | 根据ASCII字符集解析字符                                      |
| re.X  | 允许使用更灵活的格式(可以是多行、忽略空白字符、可加入注释)书写正则表达式，以便表达式更易理解 |

compile()函数用法如下：

```python

```

