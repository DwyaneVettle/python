# 第五章  子图的绘制及坐标轴共享

## 1.绘制固定区域的子图

​	matplotlib可以将整个画布规划成等分布局的m*n（行*列）的矩阵区域，并按照先行后列的方式对每个区域进行编号（编号从1开始），之后在选中的某个或某些区域中绘制单个或多个子图。

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310201039636.png" alt="image-20231020103944496" style="zoom:50%;" />

### 1.1.绘制单子图

​	使用pyplot模块的`subplot()`函数可以在规划好的某个区域中绘制单个子图。其语法结构为：

```python
subplot(nrows, ncols, index, projection, polar, sharex, sharey, 
label, **kwargs)
```

- `nrows`：表示规划区域的行数。
- `ncols`：表示规划区域的列数。
- `index`：表示选择区域的索引，默认从1开始编号。
- `projection`：表示子图的投影类型。
- `polar`：表示是否使用极坐标，默认值为False。若参数polar设为True，则作用等同于projection='polar'。



​	参数`nrows`、`ncols`、`index`既支持单独传参，也支持以一个3位整数（每位整数必须小于10）的形式传参。
`subplot()`函数会返回一个` Axes`类的子类`SubplotBase`的对象。 
​	Figure类对象可以使用`add_subplot()`方法绘制单子图，此方式与`subplot()`函数的作用是等价的。 

```python
import matplotlib.pyplot as plt

# 画布被规划为3x2的矩阵区域，之后在索引为6的区域中绘制子图
ax_one = plt.subplot(326)
ax_one.plot([1, 2, 3, 4, 5])
# 画布被绘画为3x1的矩阵区域，之后在索引为2的区域中绘制子图
ax_two = plt.subplot(312)
ax_two.plot([1, 2, 3, 4, 5])
plt.show()
```

运行结果：

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310201051620.png" alt="image-20231020105139549" style="zoom:50%;" />

### 1.2.实例：某工厂产品A与产品B去年的销售额分析

​	本实例要求根据下表的数据，先将画布规划成<font color='red'>`2*1`的矩阵区域</font>，并<font color='red'>在索引为1的区域中</font>绘制反映产品A和产品B销售额趋势的<font color='red'>折线图</font>；再将画布规划成<font color='red'>`2*2`的矩阵区域</font>，并<font color='red'>在索引为3的区域中</font>绘制反映产品A销售额占比的<font color='red'>饼图</font>；最后将画布规划成<font color='red'>`2*2`的矩阵区域</font>，并<font color='red'>在索引为4的区域中</font>绘制反映产品B销售额占比的<font color='red'>饼图</font>。

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310201055058.png" alt="image-20231020105520992" style="zoom:50%;" />

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310201055747.png" alt="image-20231020105529682" style="zoom:50%;" />

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310201055063.png" alt="image-20231020105543996" style="zoom:50%;" />

```python
import numpy as np
import matplotlib.pyplot as plt

plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False

x = [x for x in range(1, 13)]
y1 = [20, 28, 23, 16, 29, 36, 39, 33, 31, 19, 21, 25]
y2 = [17, 22, 39, 26, 35, 23, 25, 27, 29, 38, 28, 20]
labels = ['1月', '2月', '3月', '4月', '5月', '6月', '7月',
          '8月', '9月', '10月', '11月', '12月']

# 将画布规划成等分布局的2x1的矩阵区域，之后在索引为1的区域中绘制子图
ax1 = plt.subplot(211)
ax1.plot(x, y1, 'm--o', lw=2, ms=5, label='产品A')
ax1.plot(x, y2, 'g--o', lw=2, ms=5, label='产品B')
ax1.set_title('产品A与产品B的销售额趋势', fontsize=11)
ax1.set_ylim(10, 45)  # y轴区间
ax1.set_ylabel('销售额（亿元）')
ax1.set_xlabel('月份')
for xy1 in zip(x, y1):
    ax1.annotate("%s" % xy1[1], xy=xy1, xytext=(-5, 5), textcoords='offset points')
for xy2 in zip(x, y2):
    ax1.annotate("%s" % xy2[1], xy=xy2, xytext=(-5, 5), textcoords='offset points')
ax1.legend()
# 将画布规划成等分布局的2x2的矩阵区域，之后在索引为3的区域中绘制子图
ax2 = plt.subplot(223)
ax2.pie(y1, radius=1, wedgeprops={'width': 0.5}, labels=labels,
        autopct='%3.1f%%', pctdistance=0.75)
ax2.set_title('产品A的销售额')
# 将画布规划成等分布局的2x2的矩阵区域，之后在索引为4的区域中绘制子图
ax3 = plt.subplot(224)
ax3.pie(y2, radius=1, wedgeprops={'width': 0.5}, labels=labels,
        autopct='%3.1f%%', pctdistance=0.75)
ax3.set_title('产品B的销售额')
# 调整子图之间的距离
plt.tight_layout()
plt.show()
```

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310201120131.png" alt="image-20231020112043034" style="zoom:50%;" />

### 1.3.绘制多子图

​	使用pyplot模块的`subplots()`函数可以在规划好的所有区域中一次绘制多个子图。

```python
subplots（nrows=1，ncols=1，sharex=False，sharey=False，squeeze=True，subplot_kw=None，gridspec_kw=None，**fig_kw）
```

- `nrows`：表示规划区域的行数，默认为1。
- `ncols`：表示规划区域的列数，默认为1。
- `sharex, sharey`：表示是否共享子图的x轴或y轴。



​	`subplots()`函数会返回包含两个元素的元组，其中该元组的第一个元素为`Figure`对象，第二个元素为`Axes`对象或`Axes`对象数组。

```python
import matplotlib.pyplot as plt

# 将画布划分为2x2的等分区域
fig, ax_arr = plt.subplots(2, 2)
# 获取sx_arr数组第1行第0列的元素，也就是第3个区域
ax_thr = ax_arr[1, 0]
ax_thr.plot([1, 2, 3, 4, 5])
plt.show()
```

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310201133488.png" alt="image-20231020113321404" style="zoom:50%;" />

### 1.4.实例：部分国家养猫与养狗人群比例分析

​	随着人们生活水平的提高，许多人都会在家里养一些萌宠，有时还会在抖音上分享萌宠日常的可爱视频。

​	本实例要求根据下表的数据，将整个画布规划成<font color='red'>1*2的矩阵区域</font>，并在<font color='red'>索引为1和索引为2</font>的区域中分别绘制反映养猫人群比例与养狗人群比例的<font color='red'>条形图 </font>。

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310261033114.png" alt="image-20231026103157433" style="zoom:50%;" />

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310261032347.png" alt="image-20231026103203217" style="zoom:50%;" />

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310261033089.png" alt="image-20231026103350018" style="zoom:50%;" />

```python
import numpy as np
import matplotlib.pyplot as plt

plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False

# 添加无指向型注释文本
def autolabel(ax, rects):
    """ 在每个矩形条上方附加一个文本标签，以显示其高度"""
    for rect in rects:
        width = rect.get_width()  # 获取每个矩形条的高度
        ax.text(width + 3, rect.get_y(), s='{}'.format(width),
                ha='center', va='bottom')
y = np.arange(12)
x1 = np.array([19, 33, 28, 29, 14, 24, 57, 6, 26, 15, 27, 39])
x2 = np.array([25, 33, 58, 39, 15, 64, 29, 23, 22, 11, 27, 50])

labels = np.array(['中国', '加拿大', '巴西', '澳大利亚', '日本', '墨西哥',
                   '俄罗斯', '韩国', '瑞士', '土耳其', '英国', '美国'])

# 将画布规划为1x2的矩阵区域，依次在每个区域中绘制子图
fig, (ax1, ax2) = plt.subplots(1, 2)
barh_rects = ax1.barh(y, x1, height=0.5, tick_label=labels, color='#FFA500')
ax1.set_xlabel('人群比例(%)')
ax1.set_title('部分国家养猫人群的比例')
ax1.set_xlim(0, x1.max() + 10)
autolabel(ax1, barh_rects)
barh2_rects = ax2.barh(y, x2, height=0.5, tick_label=labels, color='#10B2AA')
ax1.set_xlabel('人群比例(%)')
ax1.set_title('部分国家养猫人群的比例')
ax2.set_xlim(0, x2.max() + 10)
autolabel(ax2, barh2_rects)

# 调整他子图之间的距离
plt.tight_layout()
plt.show()
```



## 2.绘制自定义区域的子图

### 2.1.绘制自定义区域子图

​	使用pyplot模块的`subplot2grid()`函数可以将整个画布规划成非等分布局的区域，并可在选中的某个区域中绘制单个子图。 语法格式如下：

```python
ubplot2grid(shape, loc, rowspan=1, colspan=1, fig=None, **kwargs)
```

- `shape`：表示<font color='red'>规划的区域结构</font>，该参数接收一个包含两个整型数据的元组，元组中第1个元素表示规划区域的行数，第2个元素代表规划区域的列数。
- `loc`：表示<font color='red'>选择区域的位置</font>，该参数接收一个包含两个整型数据的元组，元组中第1个元素表示子图所在的行数（行数从0开始），第2个元素表示子图所在的列数（列数从0开始）。
- `rowspan`：表示<font color='red'>向下跨越的行数</font>，默认为1。
- `colspan`：表示<font color='red'>向右跨越的列数</font>，默认为1。

```python
import matplotlib.pyplot as plt

# 将画布规划成2x3的矩阵区域，之后在第0行第2列的区域中绘制子图
ax1 = plt.subplot2grid((2, 3), (0, 2))
ax1.plot([1, 2, 3, 4, 5])
# 画布被规划成2x3的矩阵区域，之后在第一行第1-2列的区域中绘制子图
ax2 = plt.subplot2grid((2, 3), (1, 1), colspan=2)
ax2.plot([1, 2, 3, 4, 5])
plt.show()
```

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310261103801.png" alt="image-20231026110328723" style="zoom:50%;" />

### 2.2.实例：2017年与2018年抖音用户分析

​	抖音是一款音乐创意短视频社交软件，该软件自2016年9月上线以来受到越来越多年轻人的欢迎。用户可以通过这款软件选择歌曲，拍摄音乐短视频，生成自己的作品。 

​	本实例要求根据下表的数据，使用3个子图进行展示：在<font color='red'>第0~1行第0~1列的区域中，绘制</font>说明2018年相比于2017年人群增长倍数的<font color='red'>柱形图</font>；在<font color='red'>第2行第0列、第2行第1列的区域</font>中，分别绘制说明2017年、2018年抖音用户地区分布比例的<font color='red'>饼图</font>。

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310261105253.png" alt="image-20231026110544185" style="zoom:50%;" />

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310261105811.png" alt="image-20231026110548742" style="zoom:50%;" />

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310261106238.png" alt="image-20231026110606161" style="zoom:50%;" />

```python
import numpy as np
import matplotlib.pyplot as plt

plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False

data_2017 = np.array([21, 35, 22, 19, 3])
data_2018 = np.array([13, 32, 27, 27, 1])
x = np.arange(5)
y = np.array([51, 73, 99, 132, 45])
labels = np.array(['一线城市', '二线城市', '三线城市', '四线及以外', '其他国家及地区'])

# 平均增长倍数
average = 75
bar_width = 0.5
# 添加无指向型注释文本
def autolabel(ax, rects):
    """ 在每个举行条的上方附加一个文本标签，以显示其高度"""
    for rect in rects:
        height = rect.get_height()  # 获取每个矩形条的高度
        ax.text(rect.get_x() + bar_width / 2, height + 3,
                s='{}'.format(height), ha='center', va='bottom')

# 第一个子图
ax_one = plt.subplot2grid((3, 2), (0, 0), rowspan=2, colspan=2)
bar_rects = ax_one.bar(x, y, tick_label=labels, color='#20B2AA',
                       width=bar_width)
ax_one.set_title('抖音2018vs2017人群增长倍数')
ax_one.set_ylabel('增长倍数')
ax_one.set_ylim(0, y.max() + 20)
ax_one.axhline(y=75, ls='--', lw=1, color='gray')

# 第二个子图
ax_two = plt.subplot2grid((3, 2), (2, 0))
ax_two.pie(data_2017, radius=1.5, labels=labels, autopct='%3.1f%%',
           colors=['#2F4F4F', '#FF0000', '#A9A9A9', '#FFD700', '#B0C4DE'])
ax_two.set_title('2017年抖音用户地区分布的比例')

# 第三个子图
ax_thr = plt.subplot2grid((3, 2), (2, 1))
ax_thr.pie(data_2018, radius=1.5, labels=labels, autopct='%3.1f%%',
           colors=['#2F4F4F', '#FF0000', '#A9A9A9', '#FFD700', '#B0C4DE'])
ax_thr.set_title('2018年抖音用户地区分布的比例')

# 调整子图之间的距离
plt.tight_layout()
plt.show()
```



## 3.共享子图坐标

​	当使用subplots()函数绘制子图时，可以通过该函数的<font color='red'>sharex</font>或<font color='red'>sharey</font>参数控制是否共享<font color='red'>x轴或y轴</font>。`sharex`或`sharey`参数支持<font color='red'>False或'none'、True或'all'、'row'、'col'</font>中任一取值。

- `True或'all'`：表示所有子图之间共享x轴或y轴。
- `False或'none'`：表示所有子图之间不共享x轴或y轴。
- `'row'`：表示每一行的子图之间共享x轴或y轴。
- `'col'`：表示每一列的子图之间共享x轴或y轴。

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310261140020.png" alt="image-20231026114026919" style="zoom:50%;" />

```python
import numpy as np
import matplotlib.pyplot as plt

plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False
x1 = np.linspace(0, 2*np.pi, 400)
x2 = np.linspace(0.01, 10, 100)
x3 = np.random.rand(10)
x4 = np.arange(0, 6, 0.5)
y1 = np.cos(x1**2)
y2 = np.sin(x2)
y3 = np.linspace(0, 3, 10)
y4 = np.power(x4, 3)

# 共享每一列子图之间的x轴
fig, ax_arr = plt.subplots(2, 2, sharex='col')
ax1 = ax_arr[0, 0]
ax1.plot(x1, y1)
ax2 = ax_arr[0, 1]
ax2.plot(x2, y2)
ax3 = ax_arr[1, 0]
ax3.scatter(x3, y3)
ax4 = ax_arr[1, 1]
ax4.scatter(x4, y4)
plt.show()
```

<img src="https://gitee.com/zou_tangrui/note-pic/raw/master/img/202310261231798.png" alt="image-20231026123158700" style="zoom:50%;" />

